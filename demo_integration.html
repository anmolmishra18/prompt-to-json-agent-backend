<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt ‚Üí JSON Agent - Integration Demo for Rishabh</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; text-align: center; box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3); }
        .integration-note { background: #fef3c7; border: 2px solid #f59e0b; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }
        .card h3 { color: #1f2937; margin-bottom: 15px; border-bottom: 3px solid #4f46e5; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #374151; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 14px; transition: all 0.3s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        .btn { background: #4f46e5; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn:hover { background: #4338ca; transform: translateY(-1px); }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .result { margin-top: 15px; padding: 15px; border-radius: 8px; border-left: 4px solid #4f46e5; }
        .error { border-left-color: #ef4444; background: #fef2f2; color: #991b1b; }
        .success { border-left-color: #10b981; background: #f0fdf4; color: #065f46; }
        .warning { border-left-color: #f59e0b; background: #fffbeb; color: #92400e; }
        .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f4f6; border-top: 2px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .json-display { background: #1f2937; color: #f9fafb; padding: 15px; border-radius: 8px; font-family: 'Fira Code', 'Courier New', monospace; font-size: 13px; overflow-x: auto; white-space: pre-wrap; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-healthy { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        .code-snippet { background: #f3f4f6; padding: 15px; border-radius: 8px; font-family: 'Fira Code', monospace; font-size: 13px; margin: 10px 0; border-left: 4px solid #4f46e5; }
        .endpoint-demo { border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
        .endpoint-header { background: #f9fafb; padding: 15px; border-bottom: 1px solid #e5e7eb; font-weight: 600; color: #1f2937; }
        .endpoint-body { padding: 20px; }
        .iteration-item { background: #f8fafc; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #4f46e5; }
        .score-badge { display: inline-block; background: #4f46e5; color: white; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; margin-left: 10px; }
        .improvement-badge { background: #10b981; }
        .tabs { display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 20px; }
        .tab { padding: 12px 24px; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.3s; }
        .tab.active { border-bottom-color: #4f46e5; color: #4f46e5; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Prompt ‚Üí JSON Agent Backend</h1>
            <p>Integration Demo & Testing Interface for Frontend Development</p>
            <div id="api-status" style="margin-top: 15px;">
                <span class="status-indicator status-warning"></span>
                <span>Checking API connection...</span>
            </div>
        </div>

        <div class="integration-note">
            <h3>üîó For Rishabh (Frontend Integration)</h3>
            <p><strong>API Base URL:</strong> <code>https://prompt-to-json-agent-backend-1.onrender.com</code></p>
            <p><strong>All endpoints are CORS-enabled</strong> and ready for frontend integration. Use this demo to test API responses and error handling patterns.</p>
            <p><strong>Key Features:</strong> Comprehensive error handling, input validation, genuine RL learning, HIDG analytics</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('basic')">Basic Endpoints</div>
            <div class="tab" onclick="switchTab('advanced')">Advanced Features</div>
            <div class="tab" onclick="switchTab('integration')">Integration Guide</div>
        </div>

        <div id="basic" class="tab-content active">
            <div class="grid">
                <!-- Generate Endpoint -->
                <div class="card">
                    <div class="endpoint-demo">
                        <div class="endpoint-header">POST /generate</div>
                        <div class="endpoint-body">
                            <div class="form-group">
                                <label for="generate-prompt">Prompt (required, max 5000 chars):</label>
                                <textarea id="generate-prompt" rows="4" placeholder="Enter your prompt here...">design a mobile app for fitness tracking with social features</textarea>
                            </div>
                            <button class="btn" onclick="testGenerate()" id="generate-btn">
                                <span>üéØ</span> Generate JSON Spec
                            </button>
                            <div id="generate-result" class="result" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Evaluate Endpoint -->
                <div class="card">
                    <div class="endpoint-demo">
                        <div class="endpoint-header">POST /evaluate</div>
                        <div class="endpoint-body">
                            <div class="form-group">
                                <label for="eval-method">Evaluation Method:</label>
                                <select id="eval-method" onchange="toggleEvalInputs()">
                                    <option value="spec">Direct JSON Spec</option>
                                    <option value="report">Report ID</option>
                                </select>
                            </div>
                            <div class="form-group" id="eval-spec-group">
                                <label for="eval-spec">JSON Spec:</label>
                                <textarea id="eval-spec" rows="3" placeholder='{"title": "Fitness App", "description": "Mobile app for tracking workouts", "priority": "high"}'></textarea>
                            </div>
                            <div class="form-group" id="eval-report-group" style="display: none;">
                                <label for="eval-report-id">Report ID:</label>
                                <input type="text" id="eval-report-id" placeholder="Auto-populated from generate">
                            </div>
                            <button class="btn" onclick="testEvaluate()" id="evaluate-btn">
                                <span>‚öñÔ∏è</span> Evaluate Spec
                            </button>
                            <div id="evaluate-result" class="result" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="advanced" class="tab-content">
            <div class="grid">
                <!-- RL Iteration -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="endpoint-demo">
                        <div class="endpoint-header">POST /iterate - Reinforcement Learning Loop</div>
                        <div class="endpoint-body">
                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label for="iterate-prompt">Prompt:</label>
                                    <textarea id="iterate-prompt" rows="3" placeholder="Enter prompt for iterative improvement">create a REST API for user management with authentication</textarea>
                                </div>
                                <div class="form-group">
                                    <label for="max-iters">Max Iterations (1-10):</label>
                                    <input type="number" id="max-iters" value="4" min="1" max="10">
                                </div>
                            </div>
                            <button class="btn" onclick="testIterate()" id="iterate-btn">
                                <span>üîÑ</span> Start RL Iteration
                            </button>
                            <div id="iterate-result" class="result" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- HIDG Values -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="endpoint-demo">
                        <div class="endpoint-header">POST /log-values - Daily HIDG Reflection</div>
                        <div class="endpoint-body">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label for="honesty">Honesty (min 10 chars):</label>
                                    <textarea id="honesty" rows="2" placeholder="What worked/broke today...">API integration went smoothly after fixing CORS configuration issues</textarea>
                                </div>
                                <div class="form-group">
                                    <label for="integrity">Integrity (min 10 chars):</label>
                                    <textarea id="integrity" rows="2" placeholder="Real results recorded...">All test results documented including 2 failed deployment attempts</textarea>
                                </div>
                                <div class="form-group">
                                    <label for="discipline">Discipline (min 10 chars):</label>
                                    <textarea id="discipline" rows="2" placeholder="Tasks completed...">Completed systematic testing of all endpoints with error scenarios</textarea>
                                </div>
                                <div class="form-group">
                                    <label for="gratitude">Gratitude (min 10 chars):</label>
                                    <textarea id="gratitude" rows="2" placeholder="Thanks to team/docs...">Grateful for comprehensive API documentation that made integration easier</textarea>
                                </div>
                            </div>
                            <button class="btn" onclick="testLogValues()" id="hidg-btn">
                                <span>üíé</span> Log Daily Values
                            </button>
                            <div id="hidg-result" class="result" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="integration" class="tab-content">
            <div class="grid">
                <div class="card" style="grid-column: 1 / -1;">
                    <h3>üìã Integration Examples for Frontend</h3>
                    
                    <h4>JavaScript Fetch Example:</h4>
                    <div class="code-snippet">const response = await fetch('https://prompt-to-json-agent-backend-1.onrender.com/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ prompt: 'your prompt here' })
});
const result = await response.json();</div>

                    <h4>Error Handling Pattern:</h4>
                    <div class="code-snippet">if (!response.ok) {
  const error = await response.json();
  console.error(`API Error ${response.status}:`, error.detail);
  // Handle specific error types: ValidationError, DatabaseError, etc.
}</div>

                    <h4>Available Endpoints (All 10):</h4>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li><code>POST /generate</code> - Convert prompt to JSON spec</li>
                        <li><code>POST /evaluate</code> - Evaluate JSON spec quality</li>
                        <li><code>POST /iterate</code> - RL improvement loop</li>
                        <li><code>GET /reports/{id}</code> - Get full report with history</li>
                        <li><code>POST /log-values</code> - Store HIDG daily values</li>
                        <li><code>GET /hidg-logs</code> - View HIDG logs</li>
                        <li><code>GET /hidg-analytics</code> - HIDG insights</li>
                        <li><code>GET /health</code> - API health check</li>
                        <li><code>GET /health/db</code> - Database health check</li>
                        <li><code>GET /</code> - Root endpoint</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>üîß Quick API Tests</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-secondary" onclick="testHealthCheck()">Health Check</button>
                        <button class="btn btn-secondary" onclick="testHealthDB()">Health/DB</button>
                        <button class="btn btn-secondary" onclick="testRoot()">Root</button>
                        <button class="btn btn-secondary" onclick="testHIDGLogs()">HIDG Logs</button>
                        <button class="btn btn-secondary" onclick="testHIDGAnalytics()">HIDG Analytics</button>
                        <button class="btn btn-secondary" onclick="testErrorHandling()">Test Errors</button>
                    </div>
                    <div class="form-group">
                        <label for="report-id">Get Report by ID:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="report-id" placeholder="Auto-populated from generate/iterate">
                            <button class="btn" onclick="testGetReport()">Get Report</button>
                        </div>
                    </div>
                    <div id="quick-test-result" class="result" style="display: none;"></div>
                </div>

                <div class="card">
                    <h3>‚öôÔ∏è API Configuration</h3>
                    <div class="form-group">
                        <label for="api-base">API Base URL:</label>
                        <input type="text" id="api-base" value="https://prompt-to-json-agent-backend-1.onrender.com" placeholder="http://localhost:8000">
                    </div>
                    <button class="btn" onclick="checkAPIStatus()">Test Connection</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const getAPIBase = () => document.getElementById('api-base').value || 'https://prompt-to-json-agent-backend-1.onrender.com';
        
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        async function apiCall(endpoint, method = 'GET', data = null) {
            const url = `${getAPIBase()}${endpoint}`;
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: data ? JSON.stringify(data) : null
            };
            
            try {
                const response = await fetch(url, options);
                const result = await response.json();
                return { success: response.ok, data: result, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function showResult(elementId, result, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            
            if (typeof result === 'object') {
                element.innerHTML = `<div class="json-display">${JSON.stringify(result, null, 2)}</div>`;
            } else {
                element.innerHTML = result;
            }
        }

        function setLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (loading) {
                const originalText = btn.innerHTML;
                btn.setAttribute('data-original', originalText);
                btn.innerHTML = '<span class="loading"></span> Processing...';
                btn.disabled = true;
            } else {
                btn.innerHTML = btn.getAttribute('data-original') || btn.innerHTML;
                btn.disabled = false;
            }
        }

        async function checkAPIStatus() {
            const result = await apiCall('/health');
            const statusEl = document.getElementById('api-status');
            
            if (result.success) {
                statusEl.innerHTML = '<span class="status-indicator status-healthy"></span>API Connected - ' + result.data.message;
            } else {
                statusEl.innerHTML = '<span class="status-indicator status-error"></span>API Disconnected - ' + (result.error || 'Connection failed');
            }
        }

        async function testGenerate() {
            const prompt = document.getElementById('generate-prompt').value;
            if (!prompt.trim()) {
                showResult('generate-result', 'Please enter a prompt', true);
                return;
            }

            setLoading('generate-btn', true);
            const result = await apiCall('/generate', 'POST', { prompt });
            setLoading('generate-btn', false);
            
            if (result.success) {
                showResult('generate-result', result.data);
                // Auto-populate IDs for other tests
                if (result.data.id) {
                    document.getElementById('eval-report-id').value = result.data.id;
                    document.getElementById('report-id').value = result.data.id;
                }
            } else {
                showResult('generate-result', result.data || result.error, true);
            }
        }

        function toggleEvalInputs() {
            const method = document.getElementById('eval-method').value;
            document.getElementById('eval-spec-group').style.display = method === 'spec' ? 'block' : 'none';
            document.getElementById('eval-report-group').style.display = method === 'report' ? 'block' : 'none';
        }

        async function testEvaluate() {
            const method = document.getElementById('eval-method').value;
            let payload = {};

            if (method === 'spec') {
                const specText = document.getElementById('eval-spec').value;
                if (!specText.trim()) {
                    showResult('evaluate-result', 'Please enter JSON spec', true);
                    return;
                }
                try {
                    payload.json_spec = JSON.parse(specText);
                } catch (e) {
                    showResult('evaluate-result', 'Invalid JSON format', true);
                    return;
                }
            } else {
                const reportId = document.getElementById('eval-report-id').value;
                if (!reportId.trim()) {
                    showResult('evaluate-result', 'Please enter report ID', true);
                    return;
                }
                payload.report_id = reportId;
            }

            setLoading('evaluate-btn', true);
            const result = await apiCall('/evaluate', 'POST', payload);
            setLoading('evaluate-btn', false);
            
            showResult('evaluate-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testIterate() {
            const prompt = document.getElementById('iterate-prompt').value;
            const maxIters = parseInt(document.getElementById('max-iters').value);
            
            if (!prompt.trim()) {
                showResult('iterate-result', 'Please enter a prompt', true);
                return;
            }

            setLoading('iterate-btn', true);
            const result = await apiCall('/iterate', 'POST', { prompt, max_iters: maxIters });
            setLoading('iterate-btn', false);
            
            if (result.success) {
                let display = `<div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>üéØ Report ID:</strong> ${result.data.report_id}
                </div>`;
                
                if (result.data.learning_summary) {
                    const summary = result.data.learning_summary;
                    display += `<div style="background: #ecfdf5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <strong>üìà Learning Summary:</strong><br>
                        <span class="score-badge">Iterations: ${summary.total_iterations}</span>
                        <span class="score-badge">Initial: ${summary.initial_score.toFixed(2)}</span>
                        <span class="score-badge improvement-badge">Final: ${summary.final_score.toFixed(2)}</span>
                        <span class="score-badge improvement-badge">Improvement: +${summary.improvement.toFixed(2)}</span>
                    </div>`;
                }
                
                result.data.iterations.forEach((iter, i) => {
                    const improvement = iter.score_after > iter.score_before ? 'improvement-badge' : '';
                    display += `<div class="iteration-item">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                            <strong>üîÑ Iteration ${iter.iteration_number}</strong>
                            <span class="score-badge ${improvement}">${iter.score_before.toFixed(2)} ‚Üí ${iter.score_after.toFixed(2)}</span>
                        </div>
                        <div style="margin-bottom: 10px;"><strong>üí° Feedback:</strong> ${iter.feedback}</div>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #4f46e5; font-weight: 600;">View JSON Changes</summary>
                            <div class="json-display" style="margin-top: 10px;">
                                <strong>Before:</strong><br>${JSON.stringify(iter.before_json, null, 2)}<br><br>
                                <strong>After:</strong><br>${JSON.stringify(iter.after_json, null, 2)}
                            </div>
                        </details>
                    </div>`;
                });
                
                document.getElementById('iterate-result').innerHTML = display;
                document.getElementById('iterate-result').style.display = 'block';
                document.getElementById('iterate-result').className = 'result success';
                
                // Auto-populate report ID
                if (result.data.report_id) {
                    document.getElementById('report-id').value = result.data.report_id;
                }
            } else {
                showResult('iterate-result', result.data || result.error, true);
            }
        }

        async function testLogValues() {
            const payload = {
                honesty: document.getElementById('honesty').value,
                integrity: document.getElementById('integrity').value,
                discipline: document.getElementById('discipline').value,
                gratitude: document.getElementById('gratitude').value
            };

            // Validate all fields
            for (const [key, value] of Object.entries(payload)) {
                if (!value.trim()) {
                    showResult('hidg-result', `${key} cannot be empty`, true);
                    return;
                }
                if (value.trim().length < 10) {
                    showResult('hidg-result', `${key} must be at least 10 characters for meaningful reflection`, true);
                    return;
                }
            }

            setLoading('hidg-btn', true);
            const result = await apiCall('/log-values', 'POST', payload);
            setLoading('hidg-btn', false);
            
            showResult('hidg-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testHealthCheck() {
            const result = await apiCall('/health');
            showResult('quick-test-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testHealthDB() {
            const result = await apiCall('/health/db');
            showResult('quick-test-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testRoot() {
            const result = await apiCall('/');
            showResult('quick-test-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testHIDGLogs() {
            const result = await apiCall('/hidg-logs?limit=5');
            showResult('quick-test-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testHIDGAnalytics() {
            const result = await apiCall('/hidg-analytics');
            showResult('quick-test-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testGetReport() {
            const reportId = document.getElementById('report-id').value;
            if (!reportId.trim()) {
                showResult('quick-test-result', 'Please enter a report ID', true);
                return;
            }

            const result = await apiCall(`/reports/${reportId}`);
            showResult('quick-test-result', result.success ? result.data : (result.data || result.error), !result.success);
        }

        async function testErrorHandling() {
            const errorTests = [
                { name: 'Empty prompt', call: () => apiCall('/generate', 'POST', { prompt: '' }) },
                { name: 'Invalid JSON', call: () => apiCall('/evaluate', 'POST', { json_spec: 'invalid' }) },
                { name: 'Non-existent report', call: () => apiCall('/reports/fake-id') }
            ];

            let results = '<h4>Error Handling Tests:</h4>';
            for (const test of errorTests) {
                const result = await test.call();
                const status = result.success ? '‚úÖ' : '‚ùå';
                results += `<div>${status} ${test.name}: ${result.status} - ${result.data?.detail || result.error}</div>`;
            }
            
            document.getElementById('quick-test-result').innerHTML = results;
            document.getElementById('quick-test-result').style.display = 'block';
            document.getElementById('quick-test-result').className = 'result warning';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAPIStatus();
        });
    </script>
</body>
</html>